<html>
	<head>
		<title>Clock</title>

		<!--Bootstrap CSS and JS-->
		<link rel="stylesheet" type="text/css" href="./resources/bootstrap/css/bootstrap.css" />

		<style>
			body {
				background-color: white;
				color: black;
			}

			.fullscreen {
				font: 'Monospac82 MT';
				font-size: 190pt;
				font-weight: bolder;
			}

			#timer_fullscreen {
				display: none;
			}

			.modalscreen {
				font-size: 50pt;
			}

			small {
				font-size: 80pt;
			}

			#myauto {
				margin-top: auto;
				margin-bottom: auto;
			}
		</style>

		<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

		<script src="./resources/bootstrap/js/bootstrap.js"></script>

		<script>
			var timer_start_time = -1;
			var current_time;

			function displayClock() {
				var today = new Date();
				var hour_in_24hr = today.getHours();
				var hour_in_12hr = hour_in_24hr % 12;
				var minute = today.getMinutes();
				var second = today.getSeconds();
				var am_pm = hour_in_24hr > 11 ? 'pm' : 'am';
				minute = checkTime(minute);
				second = checkTime(second);
				current_time = hour_in_12hr + ':' + minute + ' ' + am_pm;
				document.title = current_time;
				document.getElementById('clock').innerHTML = hour_in_12hr + ':' + minute + ':' + second + ' ' + am_pm;

				var t = setTimeout(displayClock, 500);
			}

			function checkTime(input) {
				if (input < 10) {
					input = '0' + input;
				} // add zero in front of numbers < 10
				return input;
			}

			function startTimer() {
				console.log('startTimer');

				if (timer_start_time < 0) {
					console.log('set timer_start_time');
					timer_start_time = new Date();
				}

				var current_time = new Date();

				//console.log(current_time + ' ' + timer_start_time);

				var res = Math.abs(current_time - timer_start_time) / 1000;

				// get total days between two dates
				var days = Math.floor(res / 86400);
				//console.log('<br>Difference (Days): ' + days);

				// get hours
				var hours = Math.floor(res / 3600) % 24;
				//console.log('<br>Difference (Hours): ' + hours);

				// get minutes
				var minutes = Math.floor(res / 60) % 60;
				//console.log('<br>Difference (Minutes): ' + minutes);

				// get seconds
				var seconds = Math.floor(res % 60);
				//console.log('<br>Difference (Seconds): ' + seconds);

				document.getElementById('timer').innerHTML = hours + ' h : ' + minutes + ' m : ' + seconds + ' s';

				document.getElementById('timer_fullscreen').innerHTML = hours + ' <small>h</small> : ' + minutes + ' <small>m</small> : ' + seconds + ' <small>s</small>';

				document.getElementById('timer_mini_view').innerHTML = hours + ' h : ' + minutes + ' m : ' + seconds + ' s';

				//c = diff_minutes(current_time, timer_start_time);
				//console.log(c);

				var t2 = setTimeout(startTimer, 500);
			}

			/* Get the element you want displayed in fullscreen mode (a video in this example): */

			/* When the openFullscreen() function is executed, open the video in fullscreen.
			             Note that we must include prefixes for different browsers, as they don't support the requestFullscreen method yet */
			function openFullscreen() {
				var elem = document.getElementById('StopwatchModal');

				if (elem.requestFullscreen) {
					elem.requestFullscreen();
				} else if (elem.mozRequestFullScreen) {
					/* Firefox */
					elem.mozRequestFullScreen();
				} else if (elem.webkitRequestFullscreen) {
					/* Chrome, Safari and Opera */
					elem.webkitRequestFullscreen();
				} else if (elem.msRequestFullscreen) {
					/* IE/Edge */
					elem.msRequestFullscreen();
				}
			}

			function diff_minutes(date2, date1) {
				var res = Math.abs(date1 - date2) / 1000;

				// get total days between two dates
				var days = Math.floor(res / 86400);
				console.log('<br>Difference (Days): ' + days);

				// get hours
				var hours = Math.floor(res / 3600) % 24;
				console.log('<br>Difference (Hours): ' + hours);

				// get minutes
				var minutes = Math.floor(res / 60) % 60;
				console.log('<br>Difference (Minutes): ' + minutes);

				// get seconds
				var seconds = res % 60;
				console.log('<br>Difference (Seconds): ' + seconds);
			}

			function fullscreen(target) {
				document.getElementById('main').style.display = 'none';
				document.getElementById(target).style.display = 'block';
			}

			document.onkeydown = function keyPress(e) {
				if (e.key === 'Escape') {
					document.getElementById('main').style.display = 'block';
					document.getElementById('timer_fullscreen').style.display = 'none';
				}
			};
		</script>
	</head>

	<body onload="displayClock()" class="p-3" id="body">
		<div id="main">
			<h3>Clock App</h3>
			<h1 id="clock">HH:MM:SS</h1>

			<button type="button" class="btn btn-primary" onclick="openFullscreen()">
				Fullscreen
			</button>

			<!-- Button trigger modal -->
			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#timerModal">
				Timer
			</button>

			<!-- Button trigger modal -->
			<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#StopwatchModal">
				Stopwatch
			</button>

			<button type="button" class="btn btn-primary">Lo-fi</button>

			<button type="button" class="btn btn-secondary">Settings</button>

			<div id="timer_mini_view"></div>
		</div>

		<div class="row h-100">
			<div class="col-sm-12 my-auto">
				<div class="text-center fullscreen" id="timer_fullscreen">
					Test
				</div>
			</div>
		</div>
		<div id="modal_view"></div>

		<div>
			<!-- Timer Modal -->
			<div class="modal fade" id="timerModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalCenterTitle">
								Timer
							</h5>
							<button type="button" class="btn btn-outline-secondary minimize_timer">
								_
							</button>
							<button type="button" class="btn btn-outline-danger" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<h1 class="modalscreen" id="timer"></h1>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="fullscreen(timer_fullscreen)">
								Fullscreen
							</button>
							<button type="button" class="btn btn-secondary" data-dismiss="modal">
								Pause/ Play
							</button>
							<button type="button" class="btn btn-primary" onClick="startTimer()">
								Start timer
							</button>
						</div>
					</div>
				</div>
			</div>

			<!-- Modal -->
			<div class="modal fade" id="StopwatchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="exampleModalCenterTitle">
								Stopwatch
							</h5>
							<button type="button" class="btn btn-outline-secondary minimize_timer">
								_
							</button>
							<button type="button" class="btn btn-outline-danger" data-dismiss="modal" aria-label="Close">
								<span aria-hidden="true">&times;</span>
							</button>
						</div>
						<div class="modal-body">
							<div id="countdown">00:00:00</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-dismiss="modal">
								Reset
							</button>
							<button type="button" class="btn btn-primary">
								Start
							</button>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>
